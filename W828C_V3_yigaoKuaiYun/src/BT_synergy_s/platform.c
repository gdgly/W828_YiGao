/****************************************************************************                (c) CSR plc 2007                All rights reservedFILE:           platform.cDESCRIPTION:    Common file for applications that handles platform issuesREVISION:       $Revision: #1 $****************************************************************************/#include "hyOsCpuCfg.h"#include "hyTypes.h"#include "hyErrors.h"#include "hyhwChip.h"#include "hyhwCkc.h"#include "hyhwGpio.h"#include "hyhwUart.h"#include "DS28CN01.h"#include "glbVariable.h"#include "hardWare_Resource.h"//#define BT_WRITEFILE#ifdef BT_WRITEFILEint gBT_fd;#endifint *EventBt=NULL;int _kbhit(void){	return 0;}int _getch(void){	return 0;}unsigned int get_time(void){	return rawtime(NULL);}void cond_timeout_wait(unsigned int ms_10){	ewaittm(&EventBt, ms_10);}void cond_bt_wakeup(void){	ewakeup(&EventBt);}int hycoBt_open(){	hyhwWifiBt_powerCtrl(1);//打开电源		#if 0	//828上没有这个IO	hyhwGpio_setAsGpio(BT_EN_PORT, BT_EN_GPIO);	hyhwGpio_setOut(BT_EN_PORT, BT_EN_GPIO);	hyhwGpio_setHigh(BT_EN_PORT, BT_EN_GPIO);	#endif		hyhwGpio_setAsGpio(BT_RESET_PORT, BT_RESET_GPIO);	hyhwGpio_setOut(BT_RESET_PORT, BT_RESET_GPIO);	hyhwGpio_setLow(BT_RESET_PORT, BT_RESET_GPIO);	syssleep(2);	hyhwGpio_setHigh(BT_RESET_PORT, BT_RESET_GPIO);		hyUsbPrintf("bt_open!! T=%d\r\n", rawtime(NULL));		return 0;}int hycoBt_close(){	hyhwWifiBt_powerCtrl(0);//关闭电源	#if 0	//828上没有这个IO	hyhwGpio_setAsGpio(BT_EN_PORT, BT_EN_GPIO);	hyhwGpio_setOut(BT_EN_PORT, BT_EN_GPIO);	hyhwGpio_setLow(BT_EN_PORT, BT_EN_GPIO);	#endif		hyhwGpio_setAsGpio(BT_RESET_PORT, BT_RESET_GPIO);	hyhwGpio_setOut(BT_RESET_PORT, BT_RESET_GPIO);	hyhwGpio_setLow(BT_RESET_PORT, BT_RESET_GPIO);		hyUsbPrintf("bt_close!! T=%d\r\n", rawtime(NULL));}void bt_write_log(U8 *pData, int len){#ifdef BT_WRITEFILE	if(gBT_fd >= 0)	{		AbstractFileSystem_Write(gBT_fd, pData, len);	}#endif}//////	Usage://	  out/hci_spp_demo_app [-C <dev>] [-B <baud>] [-A <addr>] [-X <addr>] [-F <freq>] [-U <baud>] //	//	Where://	  -C <dev>     The serial port for the Casira. Default: '/dev/ttyS0'//	  -B <baud>    The baud rate for the Casira serial port. Default: '115200'//	  -A <addr>    The remote Bluetooth target address. Default: '0000:00:000000lX'//	  -X <addr>    The bootstrap Bluetooth address//	  -F <freq>    The crystal frequency//	  -U <baud>    The reconnect baud rate for ROM buildschar gdefConnectBdAddr[16]={0};//int hy_main(int argc, char *argv[])int hycoBt_main(void){	int argc=0;	char *argv[3];	int bd_addr_lap = 0;	char *pLap, *pSerial;		btLib_InitToSdram_buf();	hycoBt_open();	#ifdef BT_WRITEFILE	gBT_fd = AbstractFileSystem_Open("C:/BT_log.txt", 0);	if(gBT_fd >= 0)//已经存在	{		AbstractFileSystem_Close(gBT_fd);		AbstractFileSystem_DeleteFile("C:/BT_log.txt", 0);	}	gBT_fd = AbstractFileSystem_Create("C:/BT_log.txt");#endif		//strcpy(gdefConnectBdAddr, "0018:96:00142A");	//argc = 3;	//argv[0] = "out/hci_spp_demo_app";	//argv[1] = "-A";	//argv[2] = "0018:96:00142A";		//生成bd_address	pLap = (char *)&bd_addr_lap;	pSerial = &ds28cn01SerialNum.serialNum[0];		pLap[0] = pSerial[1];	pLap[1] = pSerial[2];	pLap[2] = 0xA0+(pSerial[3]&0x0F);		sprintf(gtHyc.bt_addr1 ,"0011f6%02x%02x%02x",pLap[0],pLap[1],pLap[2]);	hyco_SetBdAddress(0xF6, bd_addr_lap, 0x0011);		hyco_main(argc,argv);	hycoBt_close();#ifdef BT_WRITEFILE	if(gBT_fd >= 0)	{		AbstractFileSystem_Close(gBT_fd);		gBT_fd = -1;	}#endif}int hyco_printf(const char *format, ...){	hyUsbPrintf(format);}void csr_exit(int status){    ///todo    ///exit(status);}int csr_system(const char *command){    //system(command);}